## üîê Auth: –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞

### POST `/auth/register`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –±–∞–∑–æ–≤–æ–π —Ä–æ–ª—å—é `STUDENT` –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –≤ –≥—Ä—É–ø–ø—É `–°—Ç—É–¥–µ–Ω—Ç`.

**–í–∞–ª–∏–¥–∞—Ü–∏—è:** `registerSchema` (Zod)

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**

```json
{
  "email": "user@example.com",
  "fullName": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
  "phone": "+79991234567",
  "password": "******"
}
```

**–û—Ç–≤–µ—Ç:**

```json
{
  "token": "JWT_TOKEN",
  "user": {
    "id": "...",
    "email": "user@example.com",
    "role": "STUDENT",
    "fullName": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤"
  }
}
```

**–û—à–∏–±–∫–∏:**

- 400 ‚Äî –Ω–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ç–µ–ª–∞
- 409 ‚Äî email —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
- 500 ‚Äî –≥—Ä—É–ø–ø–∞ `–°—Ç—É–¥–µ–Ω—Ç` –Ω–µ –Ω–∞–π–¥–µ–Ω–∞

---

### POST `/auth/login`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è JWT –∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç –ø–æ —Ä–æ–ª–∏.

**–í–∞–ª–∏–¥–∞—Ü–∏—è:** `loginSchema` (Zod)

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**

```json
{
  "email": "user@example.com",
  "password": "******"
}
```

**–û—Ç–≤–µ—Ç:**

```json
{
  "token": "JWT_TOKEN",
  "user": {
    "id": "...",
    "email": "user@example.com",
    "role": "STUDENT",
    "fullName": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤"
  },
  "redirectTo": "/dashboard" // –∏–ª–∏ "/admin" –¥–ª—è ADMIN
}
```

**–û—à–∏–±–∫–∏:**

- 400 ‚Äî –Ω–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ç–µ–ª–∞
- 401 ‚Äî –Ω–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å

---

### GET `/auth/me`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–µ–∫—É—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –ø–æ JWT.

**–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:** `verifyToken`

**–û—Ç–≤–µ—Ç:**

```json
{
  "id": "...",
  "email": "user@example.com",
  "role": "STUDENT",
  "fullName": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
  "groups": [{ "id": "...", "name": "–°—Ç—É–¥–µ–Ω—Ç" }],
  "primaryGroup": {
    "id": "...",
    "name": "–°—Ç—É–¥–µ–Ω—Ç"
  }
}
```

**–û—à–∏–±–∫–∏:**

- 401 ‚Äî –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
- 404 ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω

---

### POST `/auth/forgot-password`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–∏—Å—å–º–∞ —Å–æ —Å—Å—ã–ª–∫–æ–π –Ω–∞ —Å–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è.

**–í–∞–ª–∏–¥–∞—Ü–∏—è:**

```json
{
  "email": "user@example.com"
}
```

**–û—Ç–≤–µ—Ç:**

```json
{ "success": true }
```

**–û—à–∏–±–∫–∏:**

- 400 ‚Äî –Ω–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ç–µ–ª–∞
- 500 ‚Äî —Å–±–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–∏—Å—å–º–∞ / –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Å–µ–∫—Ä–µ—Ç

---

### POST `/auth/reset-password`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è –ø–æ —Ç–æ–∫–µ–Ω—É –∏–∑ email.

**–í–∞–ª–∏–¥–∞—Ü–∏—è:**

```json
{
  "token": "TOKEN",
  "password": "–Ω–æ–≤—ã–π_–ø–∞—Ä–æ–ª—å"
}
```

**–û—Ç–≤–µ—Ç:**

```json
{ "success": true }
```

**–û—à–∏–±–∫–∏:**

- 400 ‚Äî –Ω–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ç–µ–ª–∞
- 401 ‚Äî –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–π –∏–ª–∏ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω
- 500 ‚Äî –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Å–µ–∫—Ä–µ—Ç –∏–ª–∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞

---

### üîß –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–æ—É—Ç–æ–≤

```ts
app.post('/auth/register', registerHandler);
app.post('/auth/login', loginHandler);
app.get('/auth/me', { preHandler: verifyToken }, meHandler);
app.post('/auth/forgot-password', forgotPasswordHandler);
app.post('/auth/reset-password', resetPasswordHandler);
```

**–ú–∏–¥–ª–≤–∞—Ä—ã:** `verifyToken` ‚Äî –ø–∞—Ä—Å–∏—Ç –∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç JWT, –¥–æ–±–∞–≤–ª—è–µ—Ç `user` –≤ `req`.
