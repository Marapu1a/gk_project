# Описание платформы ЦС ПАП

Мы разрабатываем независимую платформу для Центра Сертификации по Прикладному Анализу Поведения (ЦС ПАП).
Система полностью автономна и реализует весь процесс сертификации внутри собственной инфраструктуры.

---

## Этапы разработки

### Этап 1 (4 недели)

- Авторизация через email с ролевой моделью: `STUDENT`, `ADMIN`
- Личный кабинет: заявки на подтверждение супервизии
- Супервизор (уровень квалификации): подтверждение/отклонение заявок и указание количества часов
- Админ: просмотр заявок, ручная выдача сертификатов
- Публичный реестр сертифицированных специалистов

### Этап 2 (2 недели)

- Работа с CEU-записями (загрузка, просмотр, инвалидация)
- Учёт CEU-баллов в 2 шкалах: накопительная и сгорающая
- Заявки на менторство
- Публичное API: часы супервизии, баллы CEU, сертификаты
- (Опционально) Аналитика: фильтры по пользователям, регистрациям, активности

---

## Компоненты платформы

### 1. Личный кабинет пользователя:

- Отображение текущей роли
- Подача и просмотр заявок на подтверждение часов супервизии
- Загрузка и просмотр CEU-записей
- Просмотр баланса CEU-баллов (по категориям и шкалам)
- Просмотр выданных сертификатов

### 2. Админ:

- Видит все заявки и CEU-записи
- Может вручную отклонить CEU-запись
- Может менять статус заявок (например, по ошибке созданных)
- Выдаёт сертификаты вручную
- Управляет ролями, уровнями, профилями

### 3. Реестр сертифицированных специалистов:

- Публичный доступ без авторизации
- Поиск и фильтрация по имени, квалификации
- Вывод сведений по действующим сертификатам (срок, статус и т.д.)

---

## CEU-записи

Каждая CEU-запись содержит:

- Название мероприятия
- Дата проведения
- Файл (произвольный формат, обязательно визуальный)
- Количество баллов по 4 категориям (возможно 0):

  - **Этика**
  - **Культурное разнообразие**
  - **Супервизия** (не связана с заявками на подтверждение часов!)
  - **Общие баллы** (не сумма остальных)

Файл должен подтверждать количество заявленных баллов. Админ вручную проверяет адекватность содержимого и может инвалидировать запись. Инвалидированные баллы не учитываются в подсчёте.

---

## Жизненный цикл пользователя и квалификационная логика

1. Пользователь обучается ПАП за пределами платформы. Система ему пока не нужна.

2. Когда он хочет сертифицироваться — он регистрируется на платформе. Это вход в систему.

3. По умолчанию он получает роль `STUDENT`. У него нет активного сертификата — следовательно, его квалификация считается "Кандидат" (определяется по отсутствию активного сертификата).

4. Далее пользователь по мере продвижения:

   - Заполняет **заявки на подтверждение супервизии**, указывая часы по каждому виду практики (инструкторская, кураторская, супервизорская)
   - Загружает **CEU-файлы** с мероприятий, в которых указаны баллы по 4 категориям

5. **Супервизор** (пользователь с соответствующей квалификацией) подтверждает только заявки на супервизию (часы). CEU он не редактирует и не утверждает.

6. **Админ**:

   - Просматривает CEU-записи
   - Инвалидирует при необходимости
   - Проверяет, что все данные корректны, перед выдачей сертификата

7. Когда все условия выполнены (нужные часы, нужные баллы) — админ вручную **выдаёт сертификат** пользователю:

   - Заполняет форму: email, ФИО, уровень, даты начала и окончания действия сертификата
   - Загружает файл (изображение сертификата)
   - Старый сертификат становится неактивным (если был)
   - Все CEU-записи до этого момента помечаются как потраченные на сертификацию
   - Пользователь добавляется в соответствующую группу по уровню

     - Если это продление сертификата с тем же уровнем, пользователь также попадает в группу “опытный супервизор”

8. В профиле пользователя отображается его активный сертификат.

   - Если сертификата нет — считается, что это кандидат
   - Если сертификат просрочен — остаётся отображаться, но квалификация считается недействующей (правила можно расширять)

9. История всех сертификатов сохраняется. Удаление сертификатов не допускается.

---

## Заголовки ТЗ (чеклист функциональности)

1. ✅Создание заявок на подтверждение часов супервизии
2. ✅Рассмотрение заявок на подтверждение часов супервизии
3. ✅Просмотр числа подтвержденных часов супервизии
4. ✅Создание CEU-записей
5. ✅Рассмотрение созданных CEU-записей
6. Просмотр своих CEU-баллов
7. Выпуск сертификата
8. Создание заявок на подтверждение часов менторства
9. Рассмотрение заявок на подтверждение часов менторства
10. API

Текущая структура backend

backend/
├── handlers/
│ ├── applications/
│ │ ├── assigned.ts
│ │ ├── create.ts
│ │ ├── list.ts
│ │ └── update-status.ts
│ ├── auth/
│ │ ├── login.ts
│ │ └── register.ts
│ ├── ceu/
│ │ ├── create.ts
│ │ ├── invalidate.ts
│ │ └── list.ts
│ └── users/
│ ├── me.ts
│ └── supervisionHours.ts
├── lib/
│ └── prisma.ts
├── middlewares/
│ ├── requireRole.ts
│ └── verifyToken.ts
├── prisma/
│ ├── migrations/
│ └── schema.prisma
├── routes/
│ ├── applications.ts
│ ├── auth.ts
│ ├── ceu.ts
│ └── users.ts
├── schemas/
│ ├── auth.ts
│ ├── ceu.ts
│ └── supervision.ts
├── types/
│ └── fastify.d.ts
├── utils/
│ └── jwt.ts
├── server.ts
├── package.json
└── tsconfig.json

---

## API

- Публичные эндпоинты: `/registry`, `/certificates`, `/ceu`, `/hours`
- Приватные эндпоинты для UI, защищённые JWT-токеном
- Все действия логируются и верифицируются по ролям
